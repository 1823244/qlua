(Ме тут написали, что слетает кодировка файлов и пишет все в крякозяблях. Файлы должны быть в кодировке Win1251. 
Вот https://yadi.sk/d/W43-RbYa3SUVZY  на всякий случай).

Монитор рынка. 

Скрипт для Квика, выполняющий подключенные модули для указанного списка бумаг.

Теперь поясню зачем вообще эта модульность. Сам скрипт - это просто визуальная составляющая алгоритмов. Мне нужен был инструмент, позволяющий запускать мои модули для списка бумаг для разных интервалов. Я использую алгоритмы анализа объемов, поиска формаций движения, регресии, прорыв ценового канала. Открывать график каждой бумаги, смотреть - это большое время. Поэтому и написал этот инструмент. В свободной поставке я реализовал модули: расчет EMA, RSI, VSA, NRTR, регрессии, объемов.

Есть таблица со списком инструментов, выводимые значения алгоритмов, интрументы для выставления заявок.

<a href="http://funkyimg.com/view/2De4R" target="_blank"><img src="http://funkyimg.com/i/2De4R.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Что у нас здесь. 

Бумаги из файла настроек. Далее последняя цена, % изменения с открытия, % изменения за неделю (на самом деле -5 дней), цена открытия, дельта от открытия, дневной ATR, размер и средняя позиции (то, что куплено). Дневной ATR считается за период указанный в файле со списком бумаг. Я сделал подсветку значения ATR, если в течении дня было превышение значения. Т.к. не всегда смотришь за торгами, то открыв монитор, можно увидеть было ли сильное движение по бумаге в течении дня.

Это первый блок, фиксированных колонок. Далее начинаются колонки, которые показывают рассчитанные значения индикаторов(алгоритмов).

В коде скрипта можно найти строки:

<a href="http://funkyimg.com/view/2Deio" target="_blank"><img src="http://funkyimg.com/i/2Deio.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Это подключаемые модули расчета.

Колонки выводимые в таблицу определяются такой структурой:

<a href="http://funkyimg.com/view/2De5x" target="_blank"><img src="http://funkyimg.com/i/2De5x.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

У нас здесь имя колонки, признак видимости, ширина, значение интервала расчета, алгоритмы, настройки, переиод пересчета.

Имя, ширина, интервал понятно для чего. Зачем признак видимости? Для примера я сделал алгоритм VSA на часовом интервале. Выводить в интерфейс что-то не требуется, а вот рассчитать сигналы повышенного объема надо. Делаем невидимую колонку, алгоритм будет вызываться на каждой свечке и производить расчет, выдавать сигнал.

Алгоритмы - это просто имена процедур из подключенных модулей. Три типа процедур - инициализация (очистка памяти для новой бумаги), расчет показателей, вывод сигнала.
В каждом модуле я сделал такие процедуры. По образу можно писать свои. Также я встроил в основной модуль процедуру вывода сигнала up_downTest. Она выводит значения в колонку таблицы, окрашивает в нужный цвет, выдает сигнал при превышении (снижении) значения на прошлой закрытой свечке. Ее можно использовать когда не требуется что-то специфическое.

settings - это структура настроек, выполненная по образу обычных индикаторов. Вообще алгоритмы расчета очень близки к процедурам типовых индикаторов Квика.

<a href="http://funkyimg.com/view/2Deim" target="_blank"><img src="http://funkyimg.com/i/2Deim.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Еще немного про расчет значений на одном интервале. Допустим, мне надо на дневном интервале рассчитать две скользящие. Зачем вызывать два раза расчет? Проще вызвать один раз с указанным списком интервалов. Я сделал для примера такой вариант:

<a href="http://funkyimg.com/view/2Dek5" target="_blank"><img src="http://funkyimg.com/i/2Dek5.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Здесь указаны две колонки. В первой идет вызов процедур расчета allEMA, процедуры сигнала signalAllEMA и настройки allEMASettings

<a href="http://funkyimg.com/view/2Dek6" target="_blank"><img src="http://funkyimg.com/i/2Dek6.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Во второй колонке вместо вызова процедуры расчета идет вызов пустой процедуры noSignal, пустые настройки, т.к. в ней уже считать ничего не надо. Мы все посчитали в первой колонке, выведя значения и сигналы сразу для двух колонок. Т.о. мы сокращаем время выполнения и нагрузку. Как побочный эффект, т.к. у нас есть рассчитанные значения сразу для двух скользящих, то мы можем вывести сигнал о их пересечении. Это я сделал для примера в процедуре signalAllEMA модуля monitorEMA.

Последняя строка recalculatePeriod нужна для указания периода перерасчета алгоритма. Зачем она нужна, если на каждой новой свечке итак будет расчет? Я сделал такую настройку для больших интервалов. Допустим, есть дневной (или даже недельный) интервал. Его расчет будет произведен один раз при старте скрипта, т.к. боьше новых свечек не будет. Но есть сигналы, которые хотелось мониторить внутри дня. Поясню на примере регресии. Есть линия регресии, есть отклонения +- сигма, формирующие канал. Цена может приблизиться к границе канала и отскочить. Вот эти моменты и хотелось бы мониторить. Иначе сигнал поступит только завтра. А сигнал резкого касания границы и отскока вообще можно не получить. Поэтому я сделал возможность пересчета алгоритма каждый указанный интервал (в минутах), чтобы получать сигналы.

Далее, ниже таблицы интервалов, есть таблица:

<a href="http://funkyimg.com/view/2Dein" target="_blank"><img src="http://funkyimg.com/i/2Dein.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Это определение алгоритмов реального времени. Зачем они? Допустим, я хочу каждые 30 секунд вызвать некий алгоритм, что-то посчитать, вывести сообщение. Дял примера, я сделал модуль monitorVolume, в котором рассчитывается средний объем за указанное количество секунд, вывод сообщения о повышенном объеме. Но можно ведь написать и алгоритм чтения Twitter ленты с фильтром по бумагам.

В поставке я наполнил таблицу всеми вариантами, чтобы можно было оценить (понять) работу алгоритмов.

Теперь немного про вывод сигналов. В файле настроек для каждой бумаги можно указать надо ли выводить сигнал, проигрывать ли мелодию. Если все это указано, то, помимо вывода самого значения в таблицу, будет выведено сообщение и проиграна мелодия. Как я уже писал выше, типовой сигнал - это цена превысила (опустилась ниже) значение. Но я еще реализовал сигналы прохода, отскока от зоны. В settings колонки есть значение testZone. Оно измереяется в минимальных шагах цены инструмента. Зона определяется как значение алгоритма +- testZone*шаг цены. Если цена зашла внутрь зоны (сверху или снизу), то выдается сигнал. Если отскочила, тоже. Я не использую скользящие средние, но очень (очень) многие да. Как раз для случаев отскока от скользящей я и сделал такого рода сигналы для примера. Еще это используется в RSI. Но там сигналов больше. Есть значения 30, 50, 70. Вот как раз подход и отскок от этих значений и мониторится в поставляемом модуле.

Далее, для лучшего визуального контроля я сделал градацию цвета. Для примера, значение RSI = 50 считаем нейтральным - цвет белый. Близкий к 100 насыщенный зеленый, к 0 - красный. А для промежуточных значений цвет меняет насыщенность. Этот же подход я сделал в модуле регресии при подходе к границам сигма каналов.

Теперь немного как это можно использовать. Есть такая стратегия - строим скользящие средние начиная с интервала 1 минута до недели. Параметры для каждого интервала либо одинаковые, либо разные. Далее смотрим на поведение цены. Если, начиная с младших интрвалов начинают пследовательно поступать сигналы о пересечении скользящей, то это может быть признаком разворота. Так вот, если есть возможность просто глазами увидеть цветовую последовательность сигналов, то можно увидеть начало движения. Для этого мы делаем  необходимое количество колонок в таблице, указывая нужные параметры. Это один из примеров.


Далее идут колонки для торговли.

Цена - цена выставления заявки, 0 - по рынку. Далее размер позиции и кнопки управления ей. Далее команды на покупку и продажу. Последняя команда - закрыть все. Она появляется, если у Вас позиция <> 0. Она совершается по рынку.

Для предотвращения случайностей все команды совершаются двойным кликом мышки. Чтобы очистить цену высталения позиции достаточно нажать в выбранной строке Backspace. Если надо ввести конкретную цену, то можно выбрать цену открытия или текущую, кликнув (дважды) по соотвествующей колонке. Также можно дважды кликнуть по колонке значения алгоритма. Допустим, у Вас там расчет скользящей. Т.о. можно быстро ввести заявку по цене значения скользящей соответствующего интервала.

Если надо ввести конкретное значение цены, то надо дважды кликнуть по цене заявки, появится окно ввода. В нем надо выбрать строку и ввести цифры. Очистка тоже Backspace.
Тоже самое для размера позиции. Дважды кликнуть по полю и ввести или воспользоваться кнопками +-.

<a href="http://funkyimg.com/view/2Ct3D" target="_blank"><img src="http://funkyimg.com/i/2Ct2A.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>
<a href="http://funkyimg.com/view/2Ct3D" target="_blank"><img src="http://funkyimg.com/i/2Ct2L.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Для быстрого снятия всех заявок по иструменту, встаем на строку, нажимаем Shift+D, стоп-заявок - Shift+S.

Вот и все.


Теперь как все это заставить лететь:

Скрипт и модули кладем в папку LuaIndicators там где установлен Квик.

Далее надо создать еще две папки

<a href="http://funkyimg.com/view/2Ct3D" target="_blank"><img src="http://funkyimg.com/i/2Ct2F.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

В папку RobotParams надо положить файл scriptMonitor.csv. В этом файле как раз и находится список бумаг для монитора, с указанием дополнительных настроек.

<a href="http://funkyimg.com/view/2DejE" target="_blank"><img src="http://funkyimg.com/i/2DejE.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Чтобы проигрывался звук, надо положить библиотеку w32.dll в корневую папку Квика, либо отключайте в скрипте и в настройках.

<a href="http://funkyimg.com/view/2Dehm" target="_blank"><img src="http://funkyimg.com/i/2Dehm.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Далее, для торговли надо в самом скрипте указать ваши данные от брокера - счет, код клиента.

<a href="http://funkyimg.com/view/2DehP" target="_blank"><img src="http://funkyimg.com/i/2DehP.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Если Вы хотите сменить настройки хранения лога и файла параметров то здесь:

<a href="http://funkyimg.com/view/2Dehn" target="_blank"><img src="http://funkyimg.com/i/2Dehn.png" alt="Free Image Hosting at FunkyIMG.com" border="0"></a>

Теперь особенности. Т.к. скрипт тянет данные напрямую от брокера, то в Квике должен быть разрешен вывод данных по списку бумаг. Далее, для быстроты получения данных, лучше, чтобы был открыт график инструмента.

У меня открыты графики для списка бумаг. Если графика нет, то Квик данные не получает с сервера - оптимизация трафика. В этом случае скрипт посылает заявку на сервер для потока данных и по их приходу начнет их анализировать.

Сразу поясню - я не использую все эти модули. Я написал модули скользящих средних, RSI и другие для примера, чтобы Вы могли понять как писать свои или использовать их. Кто-то ведь торгует по скользящим и довольно успешно. Когда Вы откроете скрипт на Вас посыпятся сигналы. Их много, т.к. я все включил сразу. Отключайте ненужное, перенастраивайте.

Для меня же - это просто монитор показателей и платформа для алготорговли. Ведь вместе с сигналом можно и сделку совершить. В скрипт добавлены процедуры для торговли - ничто не мешает написать робота. 
